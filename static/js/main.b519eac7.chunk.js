(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(e,t,n){e.exports=n(21)},17:function(e,t,n){},18:function(e,t,n){},19:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(7),r=n.n(o),l=(n(17),n(2)),s=n(1),h=n(3),u=n(4),c=n(10),d=n(8),g=n(5),v=n(11);n(18),n(19);function f(e){var t=e.number,n=e.instructions,i=e.children;return a.a.createElement("div",{className:"Step"},a.a.createElement("div",{className:"StepDescription"},a.a.createElement("span",{className:"StepNumber"},"Step ",t,": "),a.a.createElement("span",{className:"StepInstructions"},n)),i)}var m=n(9),p=n.n(m),x=function(e){return p.a.join("/pixelator","workers",e+".worker.js")};function P(e,t,n){return new Promise(function(i,a){var o=new Worker(x("pixelator")),r=function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height).data.buffer}(e);o.postMessage({type:"pixelate",pixelWidth:t,pixelHeight:n,imgWidth:e.width,imgHeight:e.height,imgBuffer:r},[r]),o.addEventListener("message",function(e){var t=e.data;switch(t.type){case"succeeded":o.terminate(),i(new ImageData(new Uint8ClampedArray(t.imgBuffer),t.imgWidth,t.imgHeight));break;case"failed":o.terminate(),a(t.error);break;case"log":console.log(t.message);break;default:a(new TypeError("Unexpected message type: "+t.type))}})})}function w(e){return function(e){return new Promise(function(t,n){var i=new FileReader;i.addEventListener("load",function(){return t(i.result)}),i.addEventListener("error",function(){return n(i.error)}),i.readAsDataURL(e)})}(e).then(function(e){return new Promise(function(t,n){var i=document.createElement("img");i.src=e,i.addEventListener("load",function(){return t(i)}),i.addEventListener("error",n)})})}var C,y=function(){function e(){Object(h.a)(this,e)}return Object(u.a)(e,[{key:"match",value:function(e){return this.isNone()?e.none():e.some(this.value)}},{key:"isNone",value:function(){return this.isNone_}},{key:"isSome",value:function(){return!this.isNone()}},{key:"map",value:function(t){var n=this;return this.match({none:function(){return n},some:function(n){return e.some(t(n))}})}},{key:"ifSome",value:function(e){this.map(e)}},{key:"unwrap",value:function(){return this.expect("Tried to call unwrap() on Option::None")}},{key:"expect",value:function(e){return this.match({none:function(){throw"string"===typeof e?new Error(e):e},some:function(e){return e}})}},{key:"unwrapOr",value:function(e){return this.match({none:function(){return e},some:function(e){return e}})}},{key:"unwrapOrElse",value:function(e){return this.match({none:function(){return e()},some:function(e){return e}})}}],[{key:"some",value:function(t){var n=Object.create(e.prototype);return n.isNone_=!1,n.value=t,n}},{key:"none",value:function(){return b}},{key:"all",value:function(t){for(var n=[],i=0;i<t.length;i++){var a=t[i];if(!a.isSome())return e.none();n.push(a.value)}return e.some(n)}}]),e}(),b=function(){var e=Object.create(y.prototype);return e.isNone_=!0,e}(),E=function(e){function t(e){var n;return Object(h.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).originalCanvasRef=void 0,n.pixelatedCanvasRef=void 0,n.appContainerRef=void 0,window.pixelator=Object(g.a)(n),n.state={originalImg:y.none(),fileName:y.none(),pixelWidthInputValue:""+k,pixelHeightInputValue:""+k,pixelationZone:y.none(),pendingPixelationZone:y.none(),shouldPreserveNonPixelatedPortion:!0,dragState:y.none(),isPixelationComplete:!1},n.originalCanvasRef=a.a.createRef(),n.pixelatedCanvasRef=a.a.createRef(),n.appContainerRef=a.a.createRef(),n.bindMethods(),n}return Object(v.a)(t,e),Object(u.a)(t,[{key:"bindMethods",value:function(){this.onFileChange=this.onFileChange.bind(this),this.onPixelWidthChange=this.onPixelWidthChange.bind(this),this.onPixelHeightChange=this.onPixelHeightChange.bind(this),this.syncPixelWidth=this.syncPixelWidth.bind(this),this.syncPixelHeight=this.syncPixelHeight.bind(this),this.onPixelateClick=this.onPixelateClick.bind(this),this.onDownloadClick=this.onDownloadClick.bind(this),this.onShouldUseEntireImageChange=this.onShouldUseEntireImageChange.bind(this),this.onShouldPreserveNonPixelatedPortionChange=this.onShouldPreserveNonPixelatedPortionChange.bind(this),this.drawOrClearPixelationZone=this.drawOrClearPixelationZone.bind(this),this.onOriginalCanvasMouseDown=this.onOriginalCanvasMouseDown.bind(this),this.onOriginalCanvasTouchStart=this.onOriginalCanvasTouchStart.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.nativeOnTouchMove=this.nativeOnTouchMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onPendingPixelationZoneXChange=this.onPendingPixelationZoneXChange.bind(this),this.onPendingPixelationZoneYChange=this.onPendingPixelationZoneYChange.bind(this),this.onPendingPixelationZoneWidthChange=this.onPendingPixelationZoneWidthChange.bind(this),this.onPendingPixelationZoneHeightChange=this.onPendingPixelationZoneHeightChange.bind(this),this.syncPendingPixelationZone=this.syncPendingPixelationZone.bind(this)}},{key:"componentDidMount",value:function(){var e=this.originalCanvasRef.current;e.width=0,e.height=0;var t=this.pixelatedCanvasRef.current;t.width=0,t.height=0,this.appContainerRef.current.addEventListener("touchmove",this.nativeOnTouchMove,{passive:!1})}},{key:"componentWillUnmount",value:function(){this.appContainerRef.current.removeEventListener("touchmove",this.nativeOnTouchMove)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"App",ref:this.appContainerRef,onMouseMove:this.onMouseMove,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd},a.a.createElement("header",null,a.a.createElement("h1",null,"Pixelator"),a.a.createElement("p",{className:"HeaderDescription"},"An online tool for pixelating your images.")),a.a.createElement("main",null,a.a.createElement(f,{number:1},a.a.createElement("label",{className:"OrangeButton OrangeButton--inlineBlock"},"Upload an image",a.a.createElement("input",{type:"file",accept:".jpg,.jpeg,.png,.gif",onChange:this.onFileChange,className:"DisplayNone"})),this.state.originalImg.match({none:function(){return null},some:function(e){return a.a.createElement("div",null,a.a.createElement("p",{className:"SuccessfulUploadNotification"},"Your image has been successfully uploaded!"))}})),a.a.createElement(f,{number:2,instructions:"Choose pixel size."},a.a.createElement("div",null,a.a.createElement("label",null,"Width:"," ",a.a.createElement("input",{type:"text",pattern:"\\d*",value:this.state.pixelWidthInputValue,onChange:this.onPixelWidthChange,onBlur:this.syncPixelWidth}),"px")),a.a.createElement("div",null,a.a.createElement("label",null,"Height:"," ",a.a.createElement("input",{type:"text",pattern:"\\d*",value:this.state.pixelHeightInputValue,onChange:this.onPixelHeightChange,onBlur:this.syncPixelHeight}),"px"))),a.a.createElement(f,{number:3,instructions:"Choose the portion of the image to pixelate, or skip this step and the entire image will be pixelated."},a.a.createElement("div",{className:"PixelationZoneOptions"},a.a.createElement("div",null,a.a.createElement("label",null,"Select all",a.a.createElement("input",{type:"checkbox",checked:this.state.pixelationZone.isNone(),onChange:this.onShouldUseEntireImageChange}))),this.state.pixelationZone.match({none:function(){return null},some:function(t){var n=e.state.pendingPixelationZone.unwrapOrElse(function(){return R(t)});return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"PixelationZoneCoordinates"},a.a.createElement("div",null,a.a.createElement("label",null,"x:"," ",a.a.createElement("input",{type:"text",value:n.x,onChange:e.onPendingPixelationZoneXChange,onBlur:e.syncPendingPixelationZone}))),a.a.createElement("div",null,a.a.createElement("label",null,"y:"," ",a.a.createElement("input",{type:"text",value:n.y,onChange:e.onPendingPixelationZoneYChange,onBlur:e.syncPendingPixelationZone}))),a.a.createElement("div",null," ",a.a.createElement("label",null,"width:"," ",a.a.createElement("input",{type:"text",value:n.width,onChange:e.onPendingPixelationZoneWidthChange,onBlur:e.syncPendingPixelationZone}))),a.a.createElement("div",null,a.a.createElement("label",null,"height:"," ",a.a.createElement("input",{type:"text",value:n.height,onChange:e.onPendingPixelationZoneHeightChange,onBlur:e.syncPendingPixelationZone})))),a.a.createElement("div",null,a.a.createElement("label",null,"Preserve non-pixelated portion of image",a.a.createElement("input",{type:"checkbox",checked:e.state.shouldPreserveNonPixelatedPortion,onChange:e.onShouldPreserveNonPixelatedPortionChange}))))}})),a.a.createElement("canvas",{ref:this.originalCanvasRef,onMouseDown:this.onOriginalCanvasMouseDown,onTouchStart:this.onOriginalCanvasTouchStart})),a.a.createElement(f,{number:4},a.a.createElement("button",{onClick:this.onPixelateClick,className:"OrangeButton"},"Pixelate it!"),a.a.createElement("canvas",{ref:this.pixelatedCanvasRef})),a.a.createElement(f,{number:5},a.a.createElement("button",{onClick:this.onDownloadClick,className:"OrangeButton"},"Download"),a.a.createElement("p",null,"Download (either click the above button or"," ",a.a.createElement("code",{className:"DownloadInstructions"},"right-click -> Save Image As")," ","the pixelated image).")),a.a.createElement("footer",null,"Pixelator's source code can be found on"," ",a.a.createElement("a",{href:"https://github.com/kylejlin/pixelator",className:"GitHubLink"},"GitHub")," ","under the MIT License.")))}},{key:"onFileChange",value:function(e){var t=this,n=e.target.files;if(null!==n){var i=n[0];if(!(i instanceof File&&/\.(jpe?g|png|gif)$/i.test(i.name)))throw new TypeError('Uploaded file format "'.concat(i.name,'" is not supported.'));w(i).then(function(e){var n=t.originalCanvasRef.current;n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0),t.setState({originalImg:y.some(e),fileName:y.some(i.name),isPixelationComplete:!1})})}}},{key:"onPixelWidthChange",value:function(e){this.setState({pixelWidthInputValue:e.target.value})}},{key:"onPixelHeightChange",value:function(e){this.setState({pixelHeightInputValue:e.target.value})}},{key:"syncPixelWidth",value:function(){this.setState({pixelWidthInputValue:""+this.pixelWidth()})}},{key:"syncPixelHeight",value:function(){this.setState({pixelHeightInputValue:""+this.pixelHeight()})}},{key:"pixelWidth",value:function(){var e=parseInt(this.state.pixelWidthInputValue,10);return S(e)?e:k}},{key:"pixelHeight",value:function(){var e=parseInt(this.state.pixelHeightInputValue,10);return S(e)?e:k}},{key:"onPixelateClick",value:function(){var e=this;this.state.originalImg.ifSome(function(t){P(e.state.pixelationZone.match({none:function(){return t},some:function(e){return function(e,t){var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var i=n.getContext("2d");i.drawImage(e,0,0);var a=i.getImageData(t.x,t.y,t.width,t.height),o=document.createElement("canvas");return o.width=t.width,o.height=t.height,o.getContext("2d").putImageData(a,0,0),o}(t,e)}}),e.pixelWidth(),e.pixelHeight()).then(function(n){var i=e.pixelatedCanvasRef.current;if(null!==i){var a=i.getContext("2d");if(e.state.pixelationZone.isSome()&&e.state.shouldPreserveNonPixelatedPortion){var o=e.state.pixelationZone.unwrap();i.width=t.width,i.height=t.height,a.drawImage(t,0,0),a.putImageData(n,o.x,o.y)}else i.width=n.width,i.height=n.height,a.putImageData(n,0,0);e.setState({isPixelationComplete:!0})}})})}},{key:"onDownloadClick",value:function(){var e=this.pixelatedCanvasRef.current;this.state.isPixelationComplete&&null!==e&&this.state.fileName.ifSome(function(t){var n=e.toDataURL("image/png",1),i=document.createElement("a");i.href=n,i.download=function(e){var t=e.lastIndexOf(".");return-1===t?e:e.slice(0,t)}(t)+".pixelated.png",i.click()})}},{key:"onShouldUseEntireImageChange",value:function(e){var t=this;e.target.checked?this.setState({pixelationZone:y.none()},this.drawOrClearPixelationZone):this.state.originalImg.ifSome(function(e){t.setState({pixelationZone:y.some({x:0,y:0,width:e.width,height:e.height})},t.drawOrClearPixelationZone)})}},{key:"drawOrClearPixelationZone",value:function(){var e=this,t=this.originalCanvasRef.current;null!==t&&this.state.originalImg.ifSome(function(n){t.width=n.width,t.height=n.height;var i=t.getContext("2d");i.drawImage(n,0,0),e.state.pixelationZone.ifSome(function(t){if(!e.state.shouldPreserveNonPixelatedPortion){var a=i.getImageData(t.x,t.y,t.width,t.height);i.fillStyle="#000a",i.fillRect(0,0,n.width,n.height),i.putImageData(a,t.x,t.y)}i.lineWidth=2,i.strokeStyle="#08b",i.strokeRect(t.x,t.y,t.width,t.height),i.fillStyle="#08b",I(i,t.x,t.y,10),I(i,t.x+t.width,t.y,10),I(i,t.x,t.y+t.height,10),I(i,t.x+t.width,t.y+t.height,10)})})}},{key:"onShouldPreserveNonPixelatedPortionChange",value:function(e){var t=e.target;this.setState({shouldPreserveNonPixelatedPortion:t.checked},this.drawOrClearPixelationZone)}},{key:"onOriginalCanvasMouseDown",value:function(e){this.onOriginalCanvasPointerDown(e.clientX,e.clientY)}},{key:"onOriginalCanvasTouchStart",value:function(e){this.onOriginalCanvasPointerDown(e.touches[0].clientX,e.touches[0].clientY)}},{key:"onOriginalCanvasPointerDown",value:function(e,t){var n=this;this.state.pixelationZone.ifSome(function(i){var a=n.getOriginalCanvasCoords(e,t),o=Object(s.a)(a,2),r=o[0],l=o[1];n.setState({dragState:Z(r,l,i,10).map(function(e){return{corner:e,initialZone:i}})})})}},{key:"getOriginalCanvasCoords",value:function(e,t){var n=this.originalCanvasRef.current;if(null!==n){var i=n.getBoundingClientRect(),a=e-i.left,o=t-i.top;return[Math.round(n.width*a/i.width),Math.round(n.height*o/i.height)]}throw new TypeError("getOriginalCanvasCoords() was called when originalCanvasRef was null")}},{key:"onMouseMove",value:function(e){e.preventDefault(),this.onPointerMove(e.clientX,e.clientY)}},{key:"nativeOnTouchMove",value:function(e){this.state.dragState.isSome()&&e.preventDefault(),this.onPointerMove(e.touches[0].clientX,e.touches[0].clientY)}},{key:"onPointerMove",value:function(e,t){var n=this,i=this.state,a=i.originalImg,o=i.dragState;y.all([a,o]).ifSome(function(i){var a=Object(s.a)(i,2),o=a[0],r=a[1],l=r.corner,h=r.initialZone,u=n.getOriginalCanvasCoords(e,t),c=Object(s.a)(u,2),d=c[0],g=c[1];n.setState({pixelationZone:y.some(N(M(h,l,d,g),o.width,o.height))},n.drawOrClearPixelationZone)})}},{key:"onMouseUp",value:function(){this.onPointerUp()}},{key:"onTouchEnd",value:function(){this.onPointerUp()}},{key:"onPointerUp",value:function(){this.setState({dragState:y.none()})}},{key:"onPendingPixelationZoneXChange",value:function(e){var t=this;this.state.pixelationZone.ifSome(function(n){var i=e.target.value,a=t.state.pendingPixelationZone.unwrapOrElse(function(){return R(n)});t.setState({pendingPixelationZone:y.some(Object(l.a)({},a,{x:i}))})})}},{key:"onPendingPixelationZoneYChange",value:function(e){var t=this;this.state.pixelationZone.ifSome(function(n){var i=e.target.value,a=t.state.pendingPixelationZone.unwrapOrElse(function(){return R(n)});t.setState({pendingPixelationZone:y.some(Object(l.a)({},a,{y:i}))})})}},{key:"onPendingPixelationZoneWidthChange",value:function(e){var t=this;this.state.pixelationZone.ifSome(function(n){var i=e.target.value,a=t.state.pendingPixelationZone.unwrapOrElse(function(){return R(n)});t.setState({pendingPixelationZone:y.some(Object(l.a)({},a,{width:i}))})})}},{key:"onPendingPixelationZoneHeightChange",value:function(e){var t=this;this.state.pixelationZone.ifSome(function(n){var i=e.target.value,a=t.state.pendingPixelationZone.unwrapOrElse(function(){return R(n)});t.setState({pendingPixelationZone:y.some(Object(l.a)({},a,{height:i}))})})}},{key:"syncPendingPixelationZone",value:function(){var e=this,t=this.state,n=t.originalImg,i=t.pixelationZone,a=t.pendingPixelationZone;y.all([n,i,a]).ifSome(function(t){var n=Object(s.a)(t,3),i=n[0],a=n[1],o=n[2];e.setState({pixelationZone:y.some(W(o).match({none:function(){return a},some:function(e){return N(e,i.width,i.height)}})),pendingPixelationZone:y.none()},e.drawOrClearPixelationZone)})}}]),t}(a.a.Component);!function(e){e[e.TopLeft=0]="TopLeft",e[e.TopRight=1]="TopRight",e[e.BottomLeft=2]="BottomLeft",e[e.BottomRight=3]="BottomRight"}(C||(C={}));var k=10;function S(e){return!isNaN(e)&&e>0&&(t=e,Math.floor(t)===t);var t}function Z(e,t,n,i){return O(e,t,n.x,n.y)<=i?y.some(C.TopLeft):O(e,t,n.x+n.width,n.y)<=i?y.some(C.TopRight):O(e,t,n.x,n.y+n.height)<=i?y.some(C.BottomLeft):O(e,t,n.x+n.width,n.y+n.height)<=i?y.some(C.BottomRight):y.none()}function O(e,t,n,i){return Math.hypot(e-n,t-i)}function I(e,t,n,i){e.beginPath(),e.arc(t,n,i,0,2*Math.PI),e.closePath(),e.fill()}function M(e,t,n,i){var a=e.x,o=e.x+e.width,r=e.y,l=e.y+e.height;switch(t){case C.TopLeft:r=i,a=n;break;case C.TopRight:r=i,o=n;break;case C.BottomLeft:l=i,a=n;break;case C.BottomRight:l=i,o=n}if(a>o){var s=[o,a];a=s[0],o=s[1]}if(r>l){var h=[l,r];r=h[0],l=h[1]}return{x:a,y:r,width:o-a,height:l-r}}function N(e,t,n){var i=Math.max(e.x,0),a=Math.max(e.y,0);return{x:i,y:a,width:Math.min(e.width,t-i),height:Math.min(e.height,n-a)}}function R(e){return{x:""+e.x,y:""+e.y,width:""+e.width,height:""+e.height}}function W(e){var t=parseInt(e.x,10),n=parseInt(e.y,10),i=parseInt(e.width,10),a=parseInt(e.height,10);return t>=0&&n>=0&&i>0&&a>0?y.some({x:t,y:n,width:i,height:a}):y.none()}var D=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function T(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}r.a.render(a.a.createElement(E,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/pixelator",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/pixelator","/service-worker.js");D?(function(e,t){fetch(e).then(function(n){var i=n.headers.get("content-type");404===n.status||null!=i&&-1===i.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):T(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):T(t,e)})}}()}},[[12,1,2]]]);
//# sourceMappingURL=main.b519eac7.chunk.js.map